import{a as ne,b as H,r,g as A,i as re,j as ue,c,o as b,d as I,w as s,e as a,f as p,h as D,k as G,n as O}from"./index-e5d93ad7.js";const{getToken:ie,token:E}=ne();H().getUsuarioLogin();const F=H().usuario;ie();const ce=()=>{const z=r([]);return{getData:async()=>{try{const{data:l}=await A.get("/usuarios");z.value=l.usuarios}catch(l){console.log(l)}},crearUsuarioPost:async(l,n,u,k,x,h,B,g)=>{try{const{data:i}=await A.post("/usuarios/",{nombre:l,apellido:n,documento:u,direccion:k,celular:x,email:h,password:B,rol:g});return i}catch(i){return i}},editarUsuarioPut:async(l,n,u,k,x,h,B,g,i)=>{try{let m={headers:{token:E}};const{data:v}=await A.put(`usuarios/datos/${l}`,{nombre:n,apellido:u,documento:k,direccion:x,celular:h,email:B,password:g,rol:i},m);return v}catch(m){return m}},inactivarUsuario:async l=>{try{if(l==F._id)return!1;{let n={headers:{token:E}};const{data:u}=await A.put(`usuarios/desactivar/${l}`,{},n);return u}}catch(n){console.log(n)}},activarUsuario:async l=>{try{if(l==F._id)return!1;{let n={headers:{token:E}};const{data:u}=await A.put(`usuarios/activar/${l}`,{},n);return u}}catch(n){console.log(n)}},usuarios:z}},de={class:"col-xs-12 col-sm-12 col-md-6 col-lg-6 col-xl-6 q-pa-sm"},me={class:"col-xs-12 col-sm-12 col-md-6 col-lg-6 col-xl-6 q-pa-sm"},ve={class:"col-12 q-pa-sm"},fe={class:"col-xs-12 col-sm-12 col-md-6 col-lg-6 col-xl-6 q-pa-sm"},pe={class:"col-xs-12 col-sm-12 col-md-6 col-lg-6 col-xl-6 q-pa-sm"},_e={class:"col-12 q-pa-sm"},ge={class:"col-xs-12 col-sm-12 col-md-6 col-lg-6 col-xl-6 q-pl-sm q-pr-sm"},we={class:"col-xs-12 col-sm-12 col-md-6 col-lg-6 col-xl-6 q-pa-sm"},be={key:0,class:"text-green"},qe={key:1,class:"text-red"},Ue={__name:"User",setup(z){const d=re("$swal"),_=r([]),X=[{name:"nombre",label:"Nombre",align:"center",field:"nombre"},{name:"apellido",label:"Apellidos",align:"center",field:"apellido"},{name:"documento",label:"C.C.",align:"center",field:"documento",sortable:!0},{name:"direccion",label:"Dirección",align:"center",field:"direccion"},{name:"celular",label:"Telefono",align:"center",field:"celular"},{name:"email",label:"Correo",align:"center",field:"email"},{name:"estado",label:"Estado",align:"center",field:"estado",sortable:!0},{name:"rol",label:"Rol",align:"center",field:"rol",sortable:!0},{name:"opciones",label:"Opciones",align:"center",field:"opciones"}],N=r(""),C=r(!0),l=r(!1),{usuarios:n,getData:u,crearUsuarioPost:k,editarUsuarioPut:x,inactivarUsuario:h,activarUsuario:B}=ce();ue(async()=>{await u(),_.value=n.value});const g=r(""),i=r(""),m=r(""),v=r(""),q=r(""),y=r(""),U=r(""),P=r(""),V=r("AUXILIAR"),L=r(0),R=["ADMIN","AUXILIAR"],J=async()=>{const t=await k(i.value,m.value,v.value,q.value,y.value,U.value,P.value,V.value,R.value);t.msg?(l.value=!1,d.fire({icon:"success",title:t.msg,showConfirmButton:!1,timer:1500}),$(),await u(),_.value=n.value):(l.value=!1,d.fire({position:"top-end",icon:"error",title:t.response.data.errores.errors[0].msg,showConfirmButton:!1,timer:1500}),setTimeout(()=>{l.value=!0},1500))},K=t=>{g.value=t._id,i.value=t.nombre,m.value=t.apellido,v.value=t.documento,q.value=t.direccion,y.value=t.celular,U.value=t.email,V.value=t.rol,L.value=1,l.value=!0},Q=async()=>{const t=await x(g.value,i.value,m.value,v.value,q.value,y.value,U.value,P.value,V.value,R.value);t.usuario?(l.value=!1,d.fire({icon:"success",title:"Usuario editado con exito",showConfirmButton:!1,timer:1500}),$(),await u(),_.value=n.value):(l.value=!1,d.fire({position:"top-end",icon:"error",title:t.response.data.errores.errors[0].msg,showConfirmButton:!1,timer:1500}),setTimeout(()=>{l.value=!0},1500))},W=async t=>{const o=await h(t);o===!1?d.fire({icon:"error",title:"No puedes desactivar el usuario que estas usando actualmente",showConfirmButton:!1,timer:3e3}):o.msg?(d.fire({icon:"success",title:o.msg,showConfirmButton:!1,timer:1500}),$(),await u(),_.value=n.value):(d.fire({position:"top-end",icon:"error",title:"Inicia sesión nuevamente",showConfirmButton:!1,timer:1500}),setTimeout(()=>{l.value=!0},1500))},Y=async t=>{const o=await B(t);o===!1?d.fire({icon:"error",title:"No puedes activar el usuario que estas usando actualmente",showConfirmButton:!1,timer:3e3}):o.msg?(d.fire({icon:"success",title:o.msg,showConfirmButton:!1,timer:1500}),$(),await u(),_.value=n.value):(d.fire({position:"top-end",icon:"error",title:"Inicia sesión nuevamente",showConfirmButton:!1,timer:1500}),setTimeout(()=>{l.value=!0},1500))},$=()=>{g.value="",i.value="",m.value="",v.value="",q.value="",y.value="",U.value="",P.value="",V.value="AUXILIAR",L.value=0,l.value=!1};return(t,o)=>{const f=c("q-input"),j=c("q-icon"),Z=c("q-select"),ee=c("q-card-section"),w=c("q-btn"),oe=c("q-card-actions"),le=c("q-card"),ae=c("q-dialog"),T=c("q-tooltip"),M=c("q-td"),te=c("q-table"),se=c("q-page");return b(),I(se,{class:"q-pa-xl text-center"},{default:s(()=>[a(ae,{modelValue:l.value,"onUpdate:modelValue":o[12]||(o[12]=e=>l.value=e),persistent:"","transition-show":"rotate","transition-hide":"rotate"},{default:s(()=>[a(le,{style:{width:"700px","max-width":"80vw"}},{default:s(()=>[a(ee,{class:"row"},{default:s(()=>[p("div",de,[a(f,{rounded:"",outlined:"",modelValue:i.value,"onUpdate:modelValue":o[0]||(o[0]=e=>i.value=e),label:"Nombres*","lazy-rules":"",rules:[e=>e&&e.length>0||"Porfavor ingresa tus nombres"]},null,8,["modelValue","rules"])]),p("div",me,[a(f,{rounded:"",outlined:"",modelValue:m.value,"onUpdate:modelValue":o[1]||(o[1]=e=>m.value=e),label:"Apellidos*","lazy-rules":"",rules:[e=>e&&e.length>0||"Porfavor ingresa tus apellidos"]},null,8,["modelValue","rules"])]),p("div",ve,[a(f,{rounded:"",outlined:"",modelValue:q.value,"onUpdate:modelValue":o[2]||(o[2]=e=>q.value=e),label:"Dirección*","lazy-rules":"",rules:[e=>e&&e.length>0||"Porfavor ingresa tu dirección"]},null,8,["modelValue","rules"])]),p("div",fe,[a(f,{rounded:"",outlined:"",modelValue:v.value,"onUpdate:modelValue":o[3]||(o[3]=e=>v.value=e),label:"Documento*","lazy-rules":"",rules:[e=>e&&e.length>0||"Porfavor ingresa tu documento"]},null,8,["modelValue","rules"])]),p("div",pe,[a(f,{rounded:"",outlined:"",modelValue:y.value,"onUpdate:modelValue":o[4]||(o[4]=e=>y.value=e),label:"Telefono",mask:"### ### ####","unmasked-value":"","lazy-rules":"",rules:[e=>e&&e.length>0||"Porfavor ingresa tu telefono"]},null,8,["modelValue","rules"])]),p("div",_e,[a(f,{rounded:"",outlined:"",modelValue:U.value,"onUpdate:modelValue":o[5]||(o[5]=e=>U.value=e),label:"Correo","lazy-rules":"",rules:[e=>e&&e.length>0||"Porfavor ingresa tu correo"]},null,8,["modelValue","rules"])]),p("div",ge,[a(f,{rounded:"",outlined:"",class:"q-mt-sm",modelValue:P.value,"onUpdate:modelValue":o[7]||(o[7]=e=>P.value=e),label:"Contraseña",type:C.value?"password":"text",rules:[e=>e!==null&&e!==""||"Por favor ingresa tu contraseña",e=>e.length>7||"La contraseña debe tener mas de 7 caracteres"]},{append:s(()=>[a(j,{name:C.value?"visibility_off":"visibility",class:"cursor-pointer",onClick:o[6]||(o[6]=e=>C.value=!C.value)},null,8,["name"])]),_:1},8,["modelValue","type","rules"])]),p("div",we,[a(Z,{rounded:"",outlined:"",modelValue:V.value,"onUpdate:modelValue":o[8]||(o[8]=e=>V.value=e),options:R,label:"Rol"},null,8,["modelValue"])])]),_:1}),a(oe,{align:"right"},{default:s(()=>[a(w,{rounded:"",outline:"",label:"Cancerlar",color:"red",onClick:o[9]||(o[9]=e=>$())}),L.value===0?(b(),I(w,{key:0,rounded:"",outline:"",label:"Aceptar",color:"green",onClick:o[10]||(o[10]=e=>J())})):(b(),I(w,{key:1,rounded:"",outline:"",label:"Editar",color:"green",onClick:o[11]||(o[11]=e=>Q())}))]),_:1})]),_:1})]),_:1},8,["modelValue"]),a(w,{rounded:"",color:"green",class:"q-mb-md",icon:"add_circle",label:"Crea un usuario",onClick:o[13]||(o[13]=e=>l.value=!0)},{default:s(()=>[a(T,null,{default:s(()=>[D("Crear Usuario")]),_:1})]),_:1}),a(te,{dense:t.$q.screen.lt.md,flat:"",bordered:"",title:"Usuarios",filter:N.value,rows:_.value,columns:X,"row-key":"_id"},{"top-right":s(()=>[a(f,{color:"black",modelValue:N.value,"onUpdate:modelValue":o[14]||(o[14]=e=>N.value=e),placeholder:"Buscar"},{append:s(()=>[a(j,{name:"search"})]),_:1},8,["modelValue"])]),"body-cell-estado":s(e=>[a(M,{props:e},{default:s(()=>[e.row.estado===1?(b(),G("span",be," Activo ")):(b(),G("span",qe," Inactivo "))]),_:2},1032,["props"])]),"body-cell-opciones":s(e=>[a(M,{props:e},{default:s(()=>[a(w,{outline:"",rounded:"",color:"primary",icon:"edit",onClick:S=>K(e.row)},{default:s(()=>[a(T,null,{default:s(()=>[D("Editar usuario")]),_:1})]),_:2},1032,["onClick"]),e.row.estado===1?(b(),I(w,{key:0,class:O(e.row.estado==1?"q-mx-sm":""),outline:"",rounded:"",color:"red",icon:"remove_moderator",onClick:S=>W(e.row._id)},{default:s(()=>[a(T,null,{default:s(()=>[D("Inactivar usuario")]),_:1})]),_:2},1032,["class","onClick"])):(b(),I(w,{key:1,class:O(e.row.estado==0?"q-mx-sm":""),outline:"",rounded:"",color:"green",icon:"verified_user",onClick:S=>Y(e.row._id)},{default:s(()=>[a(T,null,{default:s(()=>[D("Activar usuario")]),_:1})]),_:2},1032,["class","onClick"]))]),_:2},1032,["props"])]),_:1},8,["dense","filter","rows"])]),_:1})}}};export{Ue as default};
